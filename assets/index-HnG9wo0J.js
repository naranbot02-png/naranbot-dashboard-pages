(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}})();const o={gateway:document.getElementById("gateway"),version:document.getElementById("version"),model:document.getElementById("model"),updated:document.getElementById("updated"),msgs:document.getElementById("msgs"),light:document.getElementById("light"),smart:document.getElementById("smart"),alerts:document.getElementById("alerts"),hist:document.getElementById("hist"),events:document.getElementById("events"),raw:document.getElementById("raw"),repos:document.getElementById("repos")};function d(e){try{return new Date(e).toLocaleString()}catch{return e}}function c(e,r){e.textContent=r==null||r===""?"—":String(r)}function m(e){c(o.gateway,e.gateway?.status||"unknown"),c(o.version,e.gateway?.version||"—"),c(o.model,e.model?.current||"—"),c(o.updated,d(e.updatedAt)),c(o.msgs,e.counters?.messagesToday??"—"),c(o.light,e.counters?.tickLightToday??"—"),c(o.smart,e.counters?.tickSmartToday??"—"),c(o.alerts,(e.alerts||[]).length?e.alerts.map(s=>s.title).join(" · "):"ninguna"),o.repos.innerHTML="",(e.repos||[]).forEach(s=>{const i=document.createElement("li");i.innerHTML=`<a href="${s.url}" target="_blank" rel="noreferrer">${s.name}</a>`+(s.pages?` — <a href="${s.pages}" target="_blank" rel="noreferrer">Pages</a>`:""),o.repos.appendChild(i)});const r=(e.events||[]).slice(0,30).map(s=>`[${s.ts}] ${s.kind}: ${s.msg}`).join(`
`);o.events.textContent=r||"—",o.raw.textContent=JSON.stringify(e,null,2)}async function a(){const r=await(await fetch("./status.json?ts="+Date.now(),{cache:"no-store"})).json();m(r);try{const s=await fetch("./history.json?ts="+Date.now(),{cache:"no-store"});if(s.ok){const t=(await s.json()).slice(-12).map(n=>{const l=new Date(n.ts).toLocaleTimeString(),u=n.percentUsed??"—";return`${l} · used=${u}% · model=${n.model||"—"} · last in/out=${n.lastInputTokens??"—"}/${n.lastOutputTokens??"—"}`}).join(`
`);o.hist.textContent=t||"—"}else o.hist.textContent="—"}catch{o.hist.textContent="—"}}document.getElementById("btn").addEventListener("click",a);a().catch(e=>{o.events.textContent="Error cargando status.json: "+e});
